/*
  filename: angular.integralui.combobox.min.js
  version : 1.1.7
  Copyright © 2014-2016 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Studio for Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
angular.module("integralui").factory("IntegralUIComboBoxService",["$rootScope","IntegralUIPublicService",function(b,k){return{loadData:function(f,k,d){b.$broadcast(f+"-load-data",k,d)},findItemById:function(f,k){b.$broadcast(f+"-find-item-by-id",k);var d=this.getTempData();this.clearTempData();return d?d:null},findItemByText:function(f,k){b.$broadcast(f+"-find-item-by-text",k);var d=this.getTempData();this.clearTempData();return d?d:null},getList:function(f){b.$broadcast(f+"-get-list");f=this.getTempData();this.clearTempData();return f?f:[]},selectedItem:function(f,k){if(k)b.$broadcast(f+"-set-selected-item",k);else{b.$broadcast(f+"-get-selected-item");var d=this.getTempData();this.clearTempData();return d?d:null}},refresh:function(f,k){b.$broadcast(f+"-refresh",k)},resumeLayout:function(f){b.$broadcast(f+"-resume-layout")},suspendLayout:function(f){b.$broadcast(f+"-suspend-layout")},updateLayout:function(f){b.$broadcast(f+"-update-layout")},updateView:function(f){b.$broadcast(f+"-update-view")}}}]).controller("IntegralUIComboBoxController",["$scope","$element","IntegralUIInternalService","IntegralUIComboBoxService",function(b,k,f,B){var d=this;d.defaultStyle={general:{disabled:"iui-combobox-disabled",normal:"iui-combobox"},button:{general:{disabled:"iui-combobox-button-disabled",focused:"iui-combobox-button-focused",hovered:"iui-combobox-button-hovered",normal:"iui-combobox-button"},dropdown:{disabled:"iui-combobox-button-dropdown-disabled",focused:"iui-combobox-button-dropdown-focused",hovered:"iui-combobox-button-dropdown-hovered",normal:"iui-combobox-button-dropdown"}},content:{disabled:"iui-combobox-content-disabled",focused:"iui-combobox-content-focused",hovered:"iui-combobox-content-hovered",normal:"iui-combobox-content"}};this.updateOptions=function(a){a?(d.options={dropDownHeight:f.isFieldAvailable(a.dropDownHeight,100),dropDownWidth:f.isFieldAvailable(a.dropDownWidth,200),enabled:f.isFieldAvailable(a.enabled,!0),integralHeight:f.isFieldAvailable(a.integralHeight,!0),itemIcon:f.isFieldAvailable(a.itemIcon,""),maxDropDownItems:f.isFieldAvailable(a.maxDropDownItems,7),rtl:f.isFieldAvailable(a.rtl,!1),selectedItem:f.isFieldAvailable(a.selectedItem,d.options.selectedItem?d.options.selectedItem:null),showIcons:f.isFieldAvailable(a.showIcons,!0)},d.updateDataFields(a.dataFields),d.updateControlStyle(a.controlStyle)):(d.options={controlStyle:d.defaultStyle,dropDownHeight:100,dropDownWidth:200,enabled:!0,integralHeight:!0,itemIcon:"",maxDropDownItems:7,rtl:!1,selectedItem:null,showIcons:!0},d.updateDataFields())};d.options={};this.updateDataFields=function(a){d.options.dataFields=a?{checkBoxSettings:a.checkBoxSettings?a.checkBoxSettings:"checkBoxSettings",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",enabled:a.enabled?a.enabled:"enabled",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",style:a.style?a.style:"style",text:a.text?a.text:"text",value:a.value?a.value:"value"}:{checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",content:"content",enabled:"enabled",icon:"icon",id:"id",items:"items",style:"style",text:"text",value:"value"};d.dataObj&&d.dataObj.updateDataFields(d.options.dataFields)};d.updateOptions();b.$on(b.name+"-load-data",function(a,c,b){d.loadData(c,b)});this.loadData=function(a,c){d.allowEvents=!1;d.updateDataFields(c);d.dataObj.clear(null,d.listIsCleared);angular.isDefined(b.items)&&(b.items=a);d.dataObj=new $dataService({objects:b.items,events:d.dataEvents,fields:d.getDataFields(d.options.dataFields)});d.updateLayout();d.allowEvents=!0};this.callClick=function(){angular.isDefined(b.events)&&b.events.click?b.events.click():b.click()};this.callDropDownClosing=function(){var a=!0;return a=angular.isDefined(b.events)&&b.events.dropdownClosing?b.events.dropdownClosing():b.dropdownClosing()};this.callDropDownClosed=function(){angular.isDefined(b.events)&&b.events.dropdownClosed?b.events.dropdownClosed():b.dropdownClosed()};this.callDropDownOpening=function(){var a=!0;return a=angular.isDefined(b.events)&&b.events.dropdownOpening?b.events.dropdownOpening():b.dropdownOpening()};this.callDropDownOpened=function(){angular.isDefined(b.events)&&b.events.dropdownOpened?b.events.dropdownOpened():b.dropdownOpened()};this.callEnabledChanged=function(a){angular.isDefined(b.events)&&b.events.enabledChanged?b.events.enabledChanged({enabled:a}):b.enabledChanged({e:{enabled:a}})};this.callSelectedItemChanged=function(a){angular.isDefined(b.events)&&b.events.selectedItemChanged?b.events.selectedItemChanged({item:a}):b.selectedItemChanged({e:{item:a}})};this.callStyleChanged=function(a){angular.isDefined(b.events)&&b.events.styledChanged?b.events.styleChanged({style:a}):b.styleChanged({e:{style:a}})};b.$on(b.name+"-find-item-by-id",function(a,c){B.setTempData(d.findItemById(c))});b.$on(b.name+"-find-item-by-text",function(a,c){B.setTempData(d.findItemByText(c))});this.findItemById=function(a){return d.dataObj.findObjectById(a)};this.findItemByText=function(a){return d.dataObj.findObjectByText(a)};b.$on(b.name+"-get-list",function(a){B.setTempData(d.getList())});this.getList=function(){return d.dataObj.getList()};this.isItemEnabled=function(a){return f.isEnabled(a[d.options.dataFields.enabled])};d.allowUpdate=!0;this.suspendLayout=function(){d.allowUpdate=!1};this.resumeLayout=function(){d.allowUpdate=!0;d.updateLayout()};b.$on(b.name+"-refresh",function(a,c){d.refresh(c)});b.$on(b.name+"-resume-layout",function(a){d.resumeLayout()});b.$on(b.name+"-suspend-layout",function(a){d.suspendLayout()});b.$on(b.name+"-update-layout",function(a){d.updateLayout()});b.$on(b.name+"-update-view",function(a){d.updateView()});b.$on(b.name+"-clear-selection",function(a){d.clearPrevSelection();d.options.selectedItem=null});b.$on(b.name+"-get-selected-item",function(a){B.setTempData(d.itemSelection())});b.$on(b.name+"-set-selected-item",function(a,c){d.itemSelection(c)});this.clearPrevSelection=function(){d.options.selectedItem&&(d.options.selectedItem.selected=!1);d.options.selectedItem=null;d.refresh()};this.itemSelection=function(a,c,f){if(a)d.isItemEnabled(a)&&(d.options.selectedItem=a,a.selected=!0,angular.isDefined(b.selectedItem)&&(b.selectedItem=a),d.callSelectedItemChanged(a),d.refresh());else return d.options.selectedItem};this.selectItem=function(a){angular.isDefined(b.selectedItem)?b.selectedItem=a:d.options.selectedItem=a;d.updateCombo();d.callSelectedItemChanged(a)};var l=function(a){if(a){var c;c=(c=a.general)?f.isString(c)?c:{disabled:f.isFieldAvailable(c.disabled,"iui-combobox-button-disabled"),focused:f.isFieldAvailable(c.focused,"iui-combobox-button-focused"),hovered:f.isFieldAvailable(c.hovered,"iui-combobox-button-hovered"),normal:f.isFieldAvailable(c.normal,"iui-combobox-button")}:d.defaultStyle.button.general;a=(a=a.dropdown)?f.isString(a)?a:{disabled:f.isFieldAvailable(a.disabled,"iui-combobox-button-dropdown-disabled"),focused:f.isFieldAvailable(a.focused,"iui-combobox-button-dropdown-focused"),hovered:f.isFieldAvailable(a.hovered,"iui-combobox-button-dropdown-hovered"),normal:f.isFieldAvailable(a.normal,"iui-combobox-button-dropdown")}:d.defaultStyle.button.dropdown;return{general:c,dropdown:a}}return d.defaultStyle.button},g=function(a){return a?f.isString(a)?a:{disabled:f.isFieldAvailable(a.disabled,"iui-combobox-content-disabled"),focused:f.isFieldAvailable(a.focused,"iui-combobox-content-focused"),hovered:f.isFieldAvailable(a.hovered,"iui-combobox-content-hovered"),normal:f.isFieldAvailable(a.normal,"iui-combobox-content")}:d.defaultStyle.content},m=function(a){return a?f.isString(a)?a:{disabled:f.isFieldAvailable(a.disabled,"iui-combobox-disabled"),normal:f.isFieldAvailable(a.normal,"iui-combobox")}:d.defaultStyle.general};this.updateControlStyle=function(a){d.options.controlStyle=a?{general:m(a.general),button:l(a.button),content:g(a.content)}:{general:m(d.defaultStyle.general),button:l(d.defaultStyle.button),content:g(d.defaultStyle.content)}};b.$watch("controlStyle",function(a,c){a!=c&&(d.options.controlStyle=a,d.updateLayout(),d.callStyleChanged(a))});b.$watch("dropdownHeight",function(a,c){a!=c&&(d.options.dropDownHeight=a,d.updateLayout())});b.$watch("dropdownWidth",function(a,c){a!=c&&(d.options.dropDownWidth=a,d.updateLayout())});b.$watch("enabled",function(a,c){a!=c&&(d.options.enabled=a,d.refresh(),d.callEnabledChanged(a))});b.$watch("fields",function(a,c){a!=c&&(d.options.dataFields=a,d.UpdateData())});b.$watch("integralHeight",function(a,c){a!=c&&(d.options.integralHeight=a)});b.$watch("itemIcon",function(a,c){a!=c&&(d.options.itemIcon=a,d.updateLayout())});b.$watch("maxDropdownItems",function(a,c){a!=c&&(d.options.maxDropDownItems=a)});b.$watch("options",function(a,c){a!=c&&(d.updateOptions(a),d.updateLayout())},!0);b.$watch("showIcons",function(a,c){a!=c&&(d.options.showIcons=a,d.updateLayout())});b.$watch("rtl",function(a,c){a!=c&&(d.options.rtl=a,d.updateLayout())});b.$watch("selectedItem",function(a,c){a!=c&&d.selectItem(a)})}]).directive("iuiCombobox",["$compile","$timeout","$window","$interval","IntegralUIInternalService","IntegralUIListCtrlService",function(b,k,f,B,d,l){return{restrict:"EA",controller:"IntegralUIComboBoxController",transclude:!0,replace:!0,template:'<div class="iui-combobox" data-element="combobox"><span class="iui-combobox-content"></span><span class="iui-combobox-button iui-combobox-button-dropdown"></span><span></span></div>',scope:{controlStyle:"=",dropdownHeight:"=",dropdownWidth:"=",enabled:"=",fields:"=",integralHeight:"=",itemIcon:"=",items:"=",maxDropdownItems:"=",name:"@",options:"=?",rtl:"=",selectedItem:"=",showIcons:"=",click:"&",enabledChanged:"&",events:"=?",dropdownClosed:"&",dropdownClosing:"&",dropdownOpened:"&",dropdownOpening:"&",selectedItemChanged:"&",styleChanged:"&"},link:function(g,m,a,c,C){var r=this,p=m.children().eq(0),y=m.children().eq(1),n=d.getUniqueId(4);g.listOptions={};var K=null,e='<iui-list name="'+n+'" style="position:absolute;" items="items" fields="fields" options="listOptions" after-select="onItemSelected(e)"></iui-list>',t=null,u=!1,w=0,z=0,G=0,E=function(){if(K&&angular.isDefined(g.items)&&0<g.items.length){var a=d.getUniqueId(4),n=b('<iui-list name="'+a+'" style="position:absolute;top:-99px;height:100px" items="items" item-icon="itemIcon"></iui-list>')(g);angular.element(K).append(n);l.updateLayout(a);var c=k(function(){if(0<n.children().length){var a=n.children().eq(0);0<a.children().length&&(G=angular.element(a.children().eq(0))[0].offsetHeight)}n.remove();k.cancel(c)},1)}},F=function(a){if(!u&&0!=c.callDropDownOpening()&&(t&&t.remove(),K)){t=b(e)(g);E();var d=k(function(){m.css("border-bottom-left-radius","0px");m.css("border-bottom-right-radius","0px");var a=m[0].getBoundingClientRect(),b=angular.element(f)[0].pageXOffset,e=angular.element(f)[0].pageYOffset,e=a.bottom+e-1,a=a.left+b,b=parseInt(getComputedStyle(m[0]).width,10);b<c.options.dropDownWidth&&(b=c.options.dropDownWidth);var L=c.options.dropDownHeight;c.options.integralHeight&&(L=G*c.options.maxDropDownItems);t.css("top",e+"px");t.css("left",a+"px");t.css("width",b+"px");t.css("height",L+"px");t.css("z-index","999");angular.element(K).append(t);l.selectedItem(n,c.options.selectedItem);l.updateLayout(n);var g=k(function(){l.ensureVisible(n,c.options.selectedItem);var a=k(function(){l.focus(n,c.options.selectedItem);k.cancel(a)},1);u=!0;c.callDropDownOpened();k.cancel(g)},10);k.cancel(d)},1)}},I=function(){t&&u&&0!=c.callDropDownClosing()&&(t.remove(),m.css("border-bottom-left-radius",w+"px"),m.css("border-bottom-right-radius",z+"px"),m[0].focus(),u=!1,c.callDropDownClosed())};g.$on("$destroy",function(a){r.s2t();m.unbind("click dblclick keydown mousedown mouseleave mousemove");angular.element(f).unbind("click mousemove mousedown mouseup");M();itemScope&&itemScope.$destroy()});g.onItemSelected=function(a){c.selectItem(a.item);I()};var M=function(){m.unbind("click dblclick keydown mousedown mouseleave mousemove touchstart")},N=function(){1==c.options.enabled&&(m.bind("click",function(a){c.callClick();F(a);a.stopPropagation()}),m.bind("keydown",function(a){switch(a.keyCode){case 13:F(a),a.stopPropagation()}}),m.bind("mousedown",function(a){a.stopPropagation()}),m.bind("touchstart",function(a){a.preventDefault();var n=d.getTouchData(a);n&&0<n.length&&(c.callClick(),F(a),a.stopPropagation())}))};angular.element(f).bind("mousedown",function(a){I()});var D=function(a){var n="";a[c.options.dataFields.icon]?n=a[c.options.dataFields.icon]:c.options.itemIcon&&(n=c.options.itemIcon);return n};c.updateLayout=function(){g.listOptions={itemIcon:c.options.itemIcon,navSelection:!1,rtl:c.options.rtl,showIcons:c.options.showIcons};c.refresh();var a=k(function(){K=d.getBodyElem(m[0]);w=parseInt(getComputedStyle(m[0])["border-bottom-left-radius"],10);z=parseInt(getComputedStyle(m[0])["border-bottom-right-radius"],10);M();var n="ltr";!0===c.options.rtl&&(n="rtl");m.css("direction",n);n=y[0].offsetHeight;n<p[0].offsetHeight&&(n=p[0].offsetHeight);var b=d.getPadding(m[0]),n=c.options.selectedItem&&""!=c.options.selectedItem[c.options.dataFields.text]?n+b.bottom:n+(b.top+b.bottom+1);m.css("height",n+"px");c.updateCombo();N();k.cancel(a)},1)};var x=null;c.updateCombo=function(){x&&x.remove();var a=c.options.selectedItem,n=d.getMargin(y[0]),b=d.getPadding(p[0]);c.options.showIcons&&a&&a&&(a.icon||c.options.itemIcon)?(x=angular.element('<span class="'+D(a)+'" data-element="icon" style="display:inline-block"></span>'),m.prepend(x),a=d.getMargin(x[0]),p.css("width",m[0].clientWidth-(b.left+b.right+x[0].offsetWidth+a.left+a.right+y[0].offsetWidth+n.left+n.right+8)+"px")):p.css("width",m[0].clientWidth-(b.left+b.right+y[0].offsetWidth+n.left+n.right+8)+"px");c.options.selectedItem&&p.html(c.options.selectedItem[c.options.dataFields.text])};c.refresh=function(){var a=c.defaultStyle.general.normal;c.options.controlStyle&&(a!=c.options.controlStyle.general.normal&&(a+=" "+c.options.controlStyle.general.normal),0==c.options.enabled&&c.options.controlStyle.general.disabled&&d.isString(c.options.controlStyle.general.disabled)&&(a+=" "+c.options.controlStyle.general.disabled));m.removeAttr("class");m.addClass(a);0<y.length&&(a=c.defaultStyle.button.dropdown.normal,c.options.controlStyle&&(a!=c.options.controlStyle.button.dropdown.normal&&(a+=" "+c.options.controlStyle.button.dropdown.normal),0==c.options.enabled&&c.options.controlStyle.button.dropdown.disabled&&d.isString(c.options.controlStyle.button.dropdown.disabled)&&(a+=" "+c.options.controlStyle.button.dropdown.disabled)),y.removeAttr("class"),y.addClass(a));0<p.length&&(a=c.defaultStyle.content.normal,c.options.controlStyle&&(a!=c.options.controlStyle.content.normal&&(a+=" "+c.options.controlStyle.content.normal),0==c.options.enabled&&c.options.controlStyle.content.disabled&&d.isString(c.options.controlStyle.content.disabled)&&(a+=" "+c.options.controlStyle.content.disabled)),p.removeAttr("class"),p.addClass(a))};r=this;this.crpar=function(){return["si","tri","ver","on","al "]};this.crtr=function(a){var n;n="<div style='display: none;background:white;color:#c60d0d;border:thin solid black;padding:5px;position:absolute;top:0;left:0;z-index: 99;'>";n+=a[1]+a[4]+a[2]+a[0]+a[3];return n+="</div>"};this.tpar=this.crpar();this.$tw=angular.element(this.crtr(r.tpar));this.tmp=300;this.twp=200*tmp;this.trActive=!1;this.trCount=0;this.trlTime=this.trId=null;this.trShowCount=0;this.animTr=function(){this.trCount++;3>this.trShowCount?(this.trCount=1,this.$tw.css("display","block"),this.$tw.css("top",m[0].scrollTop+"px"),this.$tw.css("left",m[0].scrollLeft+"px"),this.trShowCount++):(0===this.trCount%49&&(this.trShowCount=0),this.$tw.css("display","none"),this.$tw.css("top",m[0].scrollTop+"px"),this.$tw.css("left",m[0].scrollLeft+"px"))};this.s1t=function(a){this.trlTime=k(function(){r.trActive||(r.trCount=0,r.trActive=!0,r.trId=B(function(){r.animTr()},1E3))},a)};this.s2t=function(){this.trId&&(B.cancel(this.trId),this.trId=null);this.trlTime&&(k.cancel(this.trlTime),this.trlTime=null);this.trActive=!1;this.$tw.remove()};m.append(this.$tw);this.s1t(this.twp);angular.isDefined(g.options)?c.updateOptions(g.options):(angular.isDefined(g.controlStyle)&&c.updateControlStyle(g.controlStyle),angular.isDefined(g.dropdownHeight)&&(c.options.dropDownHeight=g.dropdownHeight),angular.isDefined(g.dropdownWidth)&&(c.options.dropDownWidth=g.dropdownWidth),angular.isDefined(g.fields)&&(c.updateDataFields(g.fields),c.updateData()),0==g.integralHeight&&(c.options.integralHeight=g.integralHeight),angular.isDefined(g.itemIcon)&&(c.options.itemIcon=g.itemIcon),angular.isDefined(g.maxDropdownItems)&&(c.options.maxDropDownItems=g.maxDropdownItems),1==g.rtl&&(c.options.rtl=g.rtl),angular.isDefined(g.selectedItem)&&(c.options.selectedItem=g.selectedItem),0==g.showIcons&&(c.options.showIcons=g.showIcons));c.updateLayout()}}}]).controller("IntegralUIListCtrlController",["$scope","$element","$timeout","$window","IntegralUIInternalService","IntegralUIDataService","IntegralUIPublicService","IntegralUIListCtrlService","IntegralUIFilter",function(b,k,f,B,d,l,g,m,a){var c=this;c.hoverItem=null;this.suppressProcess=!1;c.defaultCheckBoxStyle={general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}};c.defaultStyle={general:"iui-list",item:{general:{disabled:"iui-list-item-disabled",focused:"iui-list-item-focused",normal:"iui-list-item",hovered:"iui-list-item-hovered",selected:"iui-list-item-selected"},checkBox:{general:"iui-checkbox",box:{general:"iui-checkbox-box",disabled:"iui-checkbox-box-disabled",checked:"iui-checkbox-checked",indeterminate:"iui-checkbox-indeterminate",unchecked:"iui-checkbox-unchecked"}},content:{disabled:"iui-list-item-content-disabled",focused:"iui-list-item-content-focused",normal:"iui-list-item-content",hovered:"iui-list-item-content-hovered",selected:"iui-list-item-content-selected"}}};c.defaultCheckBoxSettings={autoCheck:!1,style:c.defaultCheckBoxStyle,threeState:!1};this.updateOptions=function(a){a?(c.options={allowFocus:d.isFieldAvailable(a.allowFocus,!0),autoCheck:d.isFieldAvailable(a.autoCheck,!1),checkBoxSettings:c.defaultCheckBoxSettings,controlStyle:c.defaultStyle,itemIcon:d.isFieldAvailable(a.itemIcon,""),navSelection:d.isFieldAvailable(a.navSelection,!0),rtl:d.isFieldAvailable(a.rtl,!1),selectedIndex:-1,selectedItem:d.isFieldAvailable(a.selectedItem,null),showCheckBoxes:d.isFieldAvailable(a.showCheckBoxes,!1),showIcons:d.isFieldAvailable(a.showIcons,!0)},c.updateDataFields(a.dataFields),c.updateControlStyle(a.controlStyle),c.updateCheckBoxSettings(a.checkBoxSettings)):(c.options={allowFocus:!0,autoCheck:!1,checkBoxSettings:c.defaultCheckBoxSettings,controlStyle:c.defaultStyle,itemIcon:"",navSelection:!0,rtl:!1,selectedIndex:-1,selectedItem:null,showCheckBoxes:!1,showIcons:!0},c.updateDataFields())};c.options={};this.updateDataFields=function(a){c.options.dataFields=a?{allowFocus:a.allowFocus?a.allowFocus:"allowFocus",autoCheck:a.autoCheck?a.autoCheck:"autoCheck",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",enabled:a.enabled?a.enabled:"enabled",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",style:a.style?a.style:"style",text:a.text?a.text:"text",value:a.value?a.value:"value"}:{allowFocus:"allowFocus",autoCheck:"autoCheck",checked:"checked",checkState:"checkState",content:"content",enabled:"enabled",icon:"icon",id:"id",style:"style",text:"text",value:"value"};c.dataObj&&c.dataObj.updateDataFields(c.options.dataFields)};c.updateOptions();b.$on(b.name+"-add-item",function(a,b){c.dataObj.insertAt(b,-1,null,c.itemIsAdded)});b.$on(b.name+"-clear-items",function(a){c.dataObj.clear(null,c.itemIsRemoved);parent||c.setScrollPos({x:0,y:0})});b.$on(b.name+"-insert-item-at",function(a,b,d){c.dataObj.insertAt(b,d,null,c.itemIsAdded)});b.$on(b.name+"-insert-item-after",function(a,b,d){c.dataObj.insertByRef(b,d,!0,c.itemIsAdded)});b.$on(b.name+"-insert-item-before",function(a,b,d){c.dataObj.insertByRef(b,d,!1,c.itemIsAdded)});b.$on(b.name+"-remove-item",function(a,b){c.dataObj.removeAt(b,-1,null,c.itemIsRemoved)});b.$on(b.name+"-remove-item-at",function(a,b){c.dataObj.removeAt(null,b,null,c.itemIsRemoved)});this.itemIsAdded=function(){c.updateLayout()};this.itemIsRemoved=function(a,b){c.updateLayout()};this.objIsRemoved=function(a,b){c.updateLayout()};this.getCheckValue=function(a){return"checked"==a[c.options.dataFields.checkState]?"checked":1==c.options.checkBoxSettings.threeState&&"indeterminate"==a[c.options.dataFields.checkState]?"indeterminate":"unchecked"};this.changeCheckValue=function(a){if(1==c.options.autoCheck||1==c.options.checkBoxSettings.autoCheck){var d=c.getCheckValue(a),e=!1,e=1==c.options.checkBoxSettings.threeState?c.callCheckValueChanging(a,d):c.callCheckValueChanging(a,"checked"==d?!0:!1);if(!1!==e){if(1==c.options.checkBoxSettings.threeState)switch(d){case "checked":d="unchecked";break;case "indeterminate":d="checked";break;case "unchecked":d="indeterminate"}else d="unchecked"==d||"indeterminate"==d?"checked":"unchecked";a[c.options.dataFields.checkState]=d;a[c.options.dataFields.checked]="checked"==d?!0:!1;b.$apply()}}};this.callCheckValueChanging=function(a,d){var e=!0;c.allowEvents&&(e=1==c.options.checkBoxSettings.threeState?angular.isDefined(b.events)&&b.events.itemCheckstateChanging?b.events.itemCheckstateChanging({item:a,value:d}):b.itemCheckstateChanging({e:{item:a,value:d}}):angular.isDefined(b.events)&&b.events.itemCheckedChanging?b.events.itemCheckedChanging({item:a,value:d}):b.itemCheckedChanging({e:{item:a,value:d}}));return e};this.callCheckValueChanged=function(a,d){c.allowEvents&&(retValue=1==c.options.checkBoxSettings.threeState?angular.isDefined(b.events)&&b.events.itemCheckstateChanged?b.events.itemCheckstateChanged({item:a,value:d}):b.itemCheckstateChanged({e:{item:a,value:d}}):angular.isDefined(b.events)&&b.events.itemCheckedChanged?b.events.itemCheckedChanged({item:a,value:d}):b.itemCheckedChanged({e:{item:a,value:d}}))};b.$on(b.name+"-get-check-list",function(n,b){void 0==b&&(b=1==c.options.checkBoxSettings.threeState?"checked":!0);var d=1==c.options.checkBoxSettings.threeState?c.options.dataFields.checkState:c.options.dataFields.checked,f={operation:"=",value:b},d=a.filter(c.getFullList(),d,f);g.setTempData(d)});this.updateCheckBoxSettings=function(a){c.options.checkBoxSettings=a?{autoCheck:d.isFieldAvailable(a.autoCheck,!1),style:p(a.style),threeState:d.isFieldAvailable(a.threeState,!1)}:{autoCheck:!1,style:c.defaultCheckBoxStyle,threeState:!1}};var C=0;c.currentList=[];c.longestItem=null;c.isThereChildItems=!1;var r=function(a,b){a.type="item";a[c.options.dataFields.id]||(a[c.options.dataFields.id]=d.getUniqueId());if(b)c.fullList.push(a);else if(c.currentList.push(a),a[c.options.dataFields.text]){var e=a[c.options.dataFields.text].length;C<e&&(C=e,c.longestItem=a)}};c.fullList=[];this.getFullList=function(a){c.fullList.length=0;a=c.dataObj.getList();for(var b=0;b<a.length;b++)r(a[b],!0);return c.fullList};this.getCurrentList=function(){return c.currentList};this.updateCurrentList=function(){C=c.currentList.length=0;var a=c.dataObj.getList();if(a)for(var b=0;b<a.length;b++)r(a[b],0,null,!1)};this.dataEvents={clear:function(a){return angular.isDefined(b.events)&&b.events.clear?b.events.clear({parent:a.e.parent}):b.clear(a)},objAdded:function(a){return angular.isDefined(b.events)&&b.events.itemAdded?b.events.itemAdded({item:a.e.item}):b.itemAdded(a)},objAdding:function(a){return angular.isDefined(b.events)&&b.events.itemAdding?b.events.itemAdding({item:a.e.item}):b.itemAdding(a)},objRemoved:function(a){return angular.isDefined(b.events)&&b.events.itemRemoved?b.events.itemRemoved({item:a.e.item}):b.itemRemoved(a)},objRemoving:function(a){return angular.isDefined(b.events)&&b.events.itemRemoving?b.events.itemRemoving({item:a.e.item}):b.itemRemoving(a)}};this.getDataFields=function(a){return{content:a.content?a.content:"content",icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",objects:a.items?a.items:"items",text:a.text?a.text:"text"}};c.dataObj=new l({objects:b.items,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)});b.$on(b.name+"-load-data",function(a,b,d){c.loadData(b,d)});this.loadData=function(a,d){c.allowEvents=!1;c.updateDataFields(d);var e=[];c.dataObj.clear(parent);a&&(e=a);angular.isDefined(b.items)&&(b.items=e);c.dataObj=new l({objects:b.items,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)});c.updateLayout();c.allowEvents=!0};this.updateData=function(){c.options.dataFields.dataSource&&(c.loadData(c.options.dataFields.dataSource),c.dataObj=new l({objects:b.items,events:c.dataEvents,fields:c.getDataFields(c.options.dataFields)}))};this.allowEvents=!0;this.callAfterSelect=function(a){angular.isDefined(b.events)&&b.events.afterSelect?b.events.afterSelect({item:a}):b.afterSelect({e:{item:a}});angular.isDefined(b.events)&&b.events.selectionChanged?b.events.selectionChanged({item:a}):b.selectionChanged({e:{item:a}})};this.callItemClick=function(a,c){angular.isDefined(b.events)&&b.events.itemClick&&b.events.itemClick({item:a,mousePos:c});b.itemClick({e:{item:a,mousePos:c}})};this.callItemDblClick=function(a,c){angular.isDefined(b.events)&&b.events.itemDblClick&&b.events.itemDblClick({item:a,mousePos:c});b.itemDblclick({e:{item:a,mousePos:c}})};this.callItemHover=function(a){angular.isDefined(b.events)&&b.events.itemHover&&b.events.itemHover({item:a});b.itemHover({e:{item:a}})};this.callItemRightClick=function(a,c){angular.isDefined(b.events)&&b.events.itemRightClick&&b.events.itemRightClick({item:a,mousePos:c});b.itemRightclick({e:{item:a,mousePos:c}})};this.callKeyDown=function(a,c){angular.isDefined(b.events)&&b.events.keyDown?b.events.keyDown({event:a,item:c}):b.keyDown({e:{event:a,item:c}})};this.callKeyPress=function(a,c){angular.isDefined(b.events)&&b.events.keyPress?b.events.keyPress({event:a,item:c}):b.keyPress({e:{event:a,item:c}})};this.callKeyUp=function(a,c){angular.isDefined(b.events)&&b.events.keyUp?b.events.keyUp({event:a,item:c}):b.keyUp({e:{event:a,item:c}})};k.bind("click",function(a){1===a.which&&c.callItemClick(null,d.getMousePos(a))});k.bind("dblclick",function(a){a.preventDefault();1===a.which&&c.callItemDblClick(null,d.getMousePos(a));a.stopPropagation()});k.bind("mousedown",function(a){3===a.which&&c.callItemRightClick(null,d.getMousePos(a));a.stopPropagation()});k.bind("mouseleave",function(a){a.preventDefault();c.hoverItem=null});this.getTabIndex=function(){return k[0].attributes&&k[0].attributes.tabindex?k[0].attributes.tabindex.value:""};this.updateFocus=function(a){if(1==c.options.allowFocus)var b=f(function(){if(a){var d=c.getElemFromItem(a);d&&d[0].focus()}else k[0].focus();f.cancel(b)},5)};b.$on(b.name+"-focus",function(a,b){c.updateFocus(b)});this.getElement=function(a,c){var b=null;c||(c="content");if(a)for(var d=a.children(),f=0;f<d.length;f++){var k=angular.element(d.eq(f));if(k[0].attributes&&k[0].attributes["data-element"]&&k[0].attributes["data-element"].value===c){b=k;break}}return b};this.getElemFromItem=function(a){var b=null;if(a){a=c.getItemCurrentIndex(a);var d=k.find("li");if(d&&0<d.length)for(var f=0;f<d.length;f++){var g=angular.element(d[f]);if(g[0].attributes["data-index"]&&g[0].attributes["data-index"].value.toString()===a.toString()){b=g;break}}}return b};this.getItemCurrentIndex=function(a){return a&&c.currentList?c.currentList.indexOf(a):-1};this.getObjCurrentIndex=function(a){return c.getItemCurrentIndex(a)};this.getObjState=function(a){if(a)switch(a.type){case "item":if(0==a[c.options.dataFields.enabled])return"disabled";if(a==c.options.selectedItem)return"selected";if(a==c.hoverItem)return"hovered"}return"normal"};this.getItemFromChildElem=function(a){return a?(a=angular.element(a))?c.getItemFromElem(a[0].parentElement):null:null};this.getItemFromElem=function(a){if(a&&(a=angular.element(a))&&a[0].attributes["data-index"]&&(a=a[0].attributes["data-index"].value,c.isIndexInRange(a)))return c.currentList[a]};this.isIndexInRange=function(a){return 0<=a&&a<c.currentList.length};this.isItemEnabled=function(a){return d.isEnabled(a[c.options.dataFields.enabled])};b.$on(b.name+"-ensure-visible",function(a,b,d){c.ensureVisible(b,d)});b.$on(b.name+"-find-item-by-id",function(a,b){m.setTempData(c.findItemById(b))});b.$on(b.name+"-find-item-by-text",function(a,b){m.setTempData(c.findItemByText(b))});b.$on(b.name+"-get-list",function(a){g.setTempData(c.getList())});this.ensureVisible=function(a,b){a&&(b||(b="center"),c.scrollTo(a,b))};this.findItemById=function(a){return c.dataObj.findObjectById(a)};this.findItemByText=function(a){return c.dataObj.findObjectByText(a)};this.getList=function(){return c.dataObj.getList()};this.getFirstItem=function(){for(var a=null,b=0;b<c.currentList.length;b++)if(c.isItemEnabled(c.currentList[b])){a=c.currentList[b];break}return a};this.getPrevItem=function(a){var b=null;if(0<=a&&a<c.currentList.length)for(--a;0<=a;a--)if(c.isItemEnabled(c.currentList[a])){b=c.currentList[a];break}return b};this.getNextItem=function(a){var b=null;for(a+=1;a<c.currentList.length;a++)if(c.isItemEnabled(c.currentList[a])){b=c.currentList[a];break}return b};this.getLastItem=function(){for(var a=null,b=c.currentList.length-1;0<=b;b--)if(c.isItemEnabled(c.currentList[b])){a=c.currentList[b];break}return a};c.allowUpdate=!0;this.suspendLayout=function(){c.allowUpdate=!1};this.resumeLayout=function(){c.allowUpdate=!0;c.updateLayout()};b.$on(b.name+"-refresh",function(a,b){c.refresh(b)});b.$on(b.name+"-resume-layout",function(a){c.resumeLayout()});b.$on(b.name+"-suspend-layout",function(a){c.suspendLayout()});b.$on(b.name+"-update-layout",function(a){c.updateLayout()});b.$on(b.name+"-update-view",function(a){c.updateView()});b.$on(b.name+"-scroll-to",function(a,b,d){c.scrollTo(b,d)});this.itemSelection=function(a,d,e){if(a)c.isItemEnabled(a)&&(c.itemSelection(),d=!0,d=angular.isDefined(b.events)&&b.events.beforeSelect?b.events.beforeSelect({item:a}):b.beforeSelect({e:{item:a}}),!1!==d&&(c.options.selectedItem=a,a.selected=!0,angular.isDefined(b.selectedItem)&&(b.selectedItem=a),(1==c.options.navSelection||e)&&c.callAfterSelect(a),c.refresh()));else return c.options.selectedItem};this.getItemAt=function(a,b){var e=null,f=null,g=null,l=k.find("li");if(l&&0<l.length)for(var m=0;m<l.length;m++)if(e=angular.element(l[m]),f=d.getPageRect(e),d.checkHit(a,b,f)){g=c.getItemFromElem(e);break}return g};b.$on(b.name+"-get-selected-item",function(a){g.setTempData(c.itemSelection())});b.$on(b.name+"-set-selected-item",function(a,b){c.itemSelection(b)});b.$watch("allowFocus",function(a,b){a!==b&&(c.options.allowFocus=a)});b.$watch("checkBoxSettings",function(a,b){a!==b&&c.updateCheckBoxSettings(a)});b.$watch("controlStyle",function(a,b){a!==b&&c.updateControlStyle(a)});b.$watch("fields",function(a,b){a!==b&&(c.options.dataFields=a,c.UpdateData())});b.$watch("hoverSelection",function(a,b){a!==b&&(c.options.hoverSelection=a)});b.$watch("itemIcon",function(a,b){a!==b&&(c.options.itemIcon=a,c.updateLayout())});b.$watch("navSelection",function(a,b){a!==b&&(c.options.navSelection=a,c.updateLayout())});b.$watch("rtl",function(a,b){a!==b&&(c.options.rtl=a,c.updateLayout())});b.$watch("showCheckBoxes",function(a,b){a!==b&&(c.options.showCheckBoxes=a,c.updateLayout())});b.$watch("showIcons",function(a,b){a!==b&&(c.options.showIcons=a,c.updateLayout())});b.$watch("showStatusIcons",function(a,b){a!==b&&(c.options.showStatusIcons=a,c.updateLayout())});b.$watch("selectedItem",function(a,b){a!==b&&(b&&(b.selected=!1),c.options.selectedItem=a,c.callAfterSelect(a))});var p=function(a){if(a){var b=d.isFieldAvailable(a.general,"iui-checkbox");a=(a=a.box)?{general:d.isFieldAvailable(a.general,"iui-checkbox-box"),disabled:d.isFieldAvailable(a.disabled,"iui-checkbox-disabled"),checked:d.isFieldAvailable(a.checked,"iui-checkbox-checked"),indeterminate:d.isFieldAvailable(a.indeterminate,"iui-checkbox-indeterminate"),unchecked:d.isFieldAvailable(a.unchecked,"iui-checkbox-unchecked")}:c.options.controlStyle.item.checkBox.box;return{general:b,box:a}}return c.options.controlStyle.item.checkBox},y=function(a){if(a){var b;b=a.general;b=d.isString(b)?b:b?{disabled:d.isFieldAvailable(b.disabled,"iui-list-item-disabled"),focused:d.isFieldAvailable(b.focused,"iui-list-item-focused"),normal:d.isFieldAvailable(b.normal,"iui-list-item"),hovered:d.isFieldAvailable(b.hovered,"iui-list-item-hovered"),selected:d.isFieldAvailable(b.selected,"iui-list-item-selected")}:c.options.controlStyle.item.general;var e=p(a.checkBox);a=a.content;a=d.isString(a)?a:a?{disabled:d.isFieldAvailable(a.disabled,"iui-list-item-content-disabled"),focused:d.isFieldAvailable(a.focused,"iui-list-item-content-focused"),normal:d.isFieldAvailable(a.normal,"iui-list-item-content"),hovered:d.isFieldAvailable(a.hovered,"iui-list-item-content-hovered"),selected:d.isFieldAvailable(a.selected,"iui-list-item-content-selected")}:c.options.controlStyle.item.content;return{general:b,checkBox:e,content:a}}return c.options.controlStyle.item};this.updateControlStyle=function(a){c.options.controlStyle=a?{general:d.isFieldAvailable(a.general,"iui-list"),item:y(a.item)}:{general:d.isFieldAvailable(c.defaultStyle.general,"iui-list"),item:y(c.defaultStyle.item)}};this.getCurrentItemStyle=function(a,b){var e=c.options.controlStyle.item;if(a)switch(a.style){case "initial":break;case "parent":return c.getCurrentItemStyle(c.getParent(a),b);default:null!=a.style&&(e=a.style)}if(b){if(d.isString(e.general))return e.general;switch(b){case "disabled":return e.general&&e.general.disabled?e.general.disabled:c.options.controlStyle.item.general.disabled;case "focused":return e.general&&e.general.focused?e.general.focused:c.options.controlStyle.item.general.focused;case "hovered":return e.general&&e.general.hovered?e.general.hovered:c.options.controlStyle.item.general.hovered;case "selected":return e.general&&e.general.selected?e.general.selected:c.options.controlStyle.item.general.selected;default:return e.general&&e.general.normal?e.general.normal:c.options.controlStyle.item.general.normal}}else return e?e:c.options.controlStyle.item};this.getCurrentItemContentStyle=function(a,b){var e=c.options.controlStyle.item.content;if(a)switch(a.style){case "initial":break;case "parent":return c.getCurrentItemContentStyle(c.getParent(a),b);default:null!=a.style&&a.style.content&&(e=a.style.content)}if(b){if(d.isString(e))return e;switch(b){case "disabled":return e&&e.disabled?e.disabled:c.options.controlStyle.item.content.disabled;case "focused":return e&&e.focused?e.focused:c.options.controlStyle.item.content.focused;case "hovered":return e&&e.hovered?e.hovered:c.options.controlStyle.item.content.hovered;case "selected":return e&&e.selected?e.selected:c.options.controlStyle.item.content.selected;default:return e&&e.normal?e.normal:c.options.controlStyle.item.content.normal}}else return e?e:c.options.controlStyle.item.content}}]).directive("iuiList",["$compile","$timeout","$window","$interval","IntegralUIInternalService",function(b,k,f,B,d){return{restrict:"EA",controller:"IntegralUIListCtrlController",transclude:!0,replace:!0,template:'<div class="iui-list" data-element="list"><ul class="iui-list-block"></ul></div>',scope:{allowFocus:"=",checkboxSettings:"=",controlStyle:"=",fields:"=",itemIcon:"=",items:"=",navSelection:"=",name:"@",options:"=?",rtl:"=",selectedIndex:"=",selectedItem:"=",showCheckBoxes:"=",showIcons:"=",afterSelect:"&",beforeSelect:"&",clear:"&",events:"=?",itemAdded:"&",itemAdding:"&",itemCheckedChanging:"&",itemCheckedChanged:"&",itemCheckstateChanging:"&",itemCheckstateChanged:"&",itemClick:"&",itemDblclick:"&",itemHover:"&",keyDown:"&",keyPress:"&",keyUp:"&",itemRemoved:"&",itemRemoving:"&",itemRightclick:"&",scrollposChanged:"&",selectionChanged:"&"},link:function(l,g,m,a,c){var C=this,r=g.children().eq(0),p=angular.element('<div class="iui-scrollbar-vertical"><div class="iui-scroll-button-thumb-vertical"></div></div>'),y=function(){var b="iui-list-block";a.options.showStatusIcons&&(b+=" "+b+"-shift-left");a.options.rtl&&(b+=" "+b+"-rtl");return b};l.$on("$destroy",function(a){g.unbind("click dblclick keydown mousedown mouseleave mousemove mousewheel scroll");n();t&&t.$destroy()});var n=function(){var a=r.find("li");if(0<a.length)for(var b=0;b<a.length;b++)currentElem=angular.element(a[b]),currentElem.unbind("click dragstart dragover drop dragenter dragleave dblclick keydown keypress keyup mouseenter mouseleave mousedown mouseup touchstart")},K=function(b){if(b){if(1==a.options.allowFocus){var c=a.getTabIndex().toString()+(a.getItemCurrentIndex(a.getItemFromElem(b))+1).toString();b.attr("tabindex",c)}b.bind("click",function(b){if(1===b.which){var c=a.getItemFromElem(this);c&&a.callItemClick(c,d.getMousePos(b))}b.stopPropagation()});b.bind("dblclick",function(b){b.preventDefault();if(1===b.which){var c=a.getItemFromElem(this);c&&a.callItemDblClick(c,d.getMousePos(b))}b.stopPropagation()});b.bind("mousedown",function(b){var c=a.getItemFromElem(this);if(c)switch(a.itemSelection(c,!0,!0),b.which){case 1:a.changeCheckValue(c);break;case 3:a.callItemRightClick(c,d.getMousePos(b))}b.stopPropagation()});b.bind("mouseup",function(a){});b.bind("mouseenter",function(b){if(b=a.getItemFromElem(this))angular.element(this),a.hoverItem=b,a.refresh(),a.callItemHover(b)});b.bind("mouseleave",function(b){a.hoverItem=null;a.getItemFromElem(this)&&a.refresh()});b.bind("touchstart",function(b){b.preventDefault();var c=d.getTouchData(b);if(c&&0<c.length){if(c=a.getItemFromElem(this))a.itemSelection(c,!0,!0),a.changeCheckValue(c);b.stopPropagation()}})}var h=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),h=e+z-2,h=h<a.currentList.length-1?h:a.currentList.length-1;d===h&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(g[0].clientHeight/4)}),focusDelayTime=1);var q=a.getNextItem(d);if(q){a.itemSelection(q);l.$apply();var f=k(function(){a.updateFocus(q);k.cancel(f)},focusDelayTime)}},f=function(b,c){b.preventDefault();focusDelayTime=0;var d=a.getItemCurrentIndex(c),h=e;d===(0<h?h:0)&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-Math.floor(g[0].clientHeight/4)}),focusDelayTime=1);var q=a.getPrevItem(a.getItemCurrentIndex(c));if(q){a.itemSelection(q);l.$apply();var f=k(function(){a.updateFocus(q);k.cancel(f)},focusDelayTime)}};b.bind("keydown",function(b){var c=a.getItemFromElem(this);if(c){var q=0;switch(b.keyCode){case 9:var e=a.currentList.length;0<e&&(b.shiftKey?d.isEqual(c[a.options.dataFields.id],a.currentList[0][a.options.dataFields.id])||f(b,c):d.isEqual(c[a.options.dataFields.id],a.currentList[e-1][a.options.dataFields.id])||h(b,c));break;case 13:a.itemSelection(c,!0,!0);break;case 33:b.preventDefault();q=a.getItemCurrentIndex(c);e=q-z;e=0<e?e:0;if(e!==q){var q=1,g=a.getPrevItem(e+1);if(g){a.scrollTo(g);a.itemSelection(g);l.$apply();var O=k(function(){a.updateFocus(g);k.cancel(O)},q)}}break;case 34:b.preventDefault();q=a.getItemCurrentIndex(c);e=q+z;e=e<a.currentList.length-1?e:a.currentList.length-1;e!==q&&(q=1,g=a.getNextItem(e-1))&&(a.scrollTo(g,"bottom"),a.itemSelection(g),l.$apply(),O=k(function(){a.updateFocus(g);k.cancel(O)},q));break;case 35:b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:H.y});var m=a.getLastItem();m&&(a.itemSelection(m),O=k(function(){a.updateFocus(m);k.cancel(O)},1));break;case 36:b.preventDefault();a.setScrollPos({x:a.scrollPos.x,y:0});var n=a.getFirstItem();n&&(a.itemSelection(n),O=k(function(){a.updateFocus(n);k.cancel(O)},1));break;case 38:f(b,c);break;case 40:h(b,c)}}a.callKeyDown(b,c)});b.bind("keyup",function(b){var c=a.getItemFromElem(this);a.callKeyUp(b,c)});b.bind("keypress",function(b){var c=a.getItemFromElem(this);a.callKeyPress(b,c)})},e=0,t=null,u=100,w=0,z=0,G=0,E=0,F=!1,I=9,M=0,N=0,D=0,x=0,L=1,v=null,A=!1;this.scrollMousePos=null;var H={x:0,y:0},N=0;a.updateViewSize=function(){var c=k(function(){A=!1;if(0<a.currentList.length){var e=angular.element(b(W(0,!0))(l));g.append(e);var h=d.getMargin(e[0]);w=e[0].offsetHeight+(h.top+h.bottom);u=Math.floor((g[0].offsetHeight-6)/w)+1;A=!1;u<a.currentList.length+1&&(p.unbind("click mousedown mouseup"),g.append(p),p.bind("click",function(a){a.stopPropagation()}),p.bind("mousedown",function(b){b=d.getClientMousePos(b,this);var c=Math.floor(g[0].clientHeight);v&&(b.y<v[0].offsetTop?(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y-c}),X(!1,c)):b.y>v[0].offsetTop+v[0].offsetHeight&&(a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+c}),X(!0,c)))}),p.bind("mouseup",function(a){a.stopPropagation()}),v=angular.element(p.children().eq(0)),A=!0,v.bind("mousedown",function(a){1===a.which&&(C.scrollMousePos=d.getMousePos(a),F=!0);a.stopPropagation()}));e.remove()}A||(p.unbind("click mousedown mouseup"),p.remove());k.cancel(c);!A&&0<a.scrollPos.y&&a.setScrollPos({x:0,y:0})},1)};var T=function(){var b=k(function(){G=g[0].offsetWidth-6;E=g[0].offsetHeight-6;E-=4;G=A?G-p[0].offsetWidth:G-4;r.css("width",G+"px");r.css("height",E+"px");A&&(p.css("top","0px"),E+=3,p.css("height",E+1+"px"));!1!==a.options.rtl?(r.css("left","auto"),r.css("right","-"+(a.scrollPos.x-2).toString()+"px"),A&&(p.css("left","0px"),p.css("right","auto"))):(r.css("left","-"+(a.scrollPos.x-2).toString()+"px"),r.css("right","auto"),A&&(p.css("left","auto"),p.css("right","0px")));var c=k(function(){var b=a.currentList.length+1;A&&0<a.currentList.length&&u<b&&(D=2,x=p[0].clientHeight-4,M=0,x>D&&(M=x-D),I=Math.floor(M*u/b),9>I&&(I=9),v.css("height",I+"px"),L=(b-u)/(M-I-2),H.y=(b-u)*w,0>H.y&&(H.y=0),0==e?v.css("top",D+"px"):e+u-1==a.currentList.length&&v.css("top",x-v[0].offsetHeight+"px"));k.cancel(c)},1);k.cancel(b)},5)};a.updateLayout=function(b){a.allowUpdate&&(g.removeClass("iui-list-block-rtl"),a.options.rtl&&g.addClass("iui-list-block-rtl"),r.removeClass("iui-list-block-shift-left iui-list-block-rtl"),r.addClass(y()),w=0,u=100,u=Math.floor(g[0].clientHeight/20),a.updateCurrentList(),Y(),a.updateView(b),a.updateView(b),k(function(){a.updateViewSize();a.updateViewSize();T()},1))};l.onCheckValueChanging=function(b,c){return a.callCheckValueChanging(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)};l.onCheckValueChanged=function(b,c){a.callCheckValueChanged(a.currentList[c],a.options.checkBoxSettings&&1==a.options.checkBoxSettings.threeState?b.checkState:b.checked)};var W=function(b,c){var h=a.currentList[b],e=a.defaultStyle.item.general.normal,f=a.getCurrentItemStyle(h,a.getObjState(h)),h='<li class="'+e;f!=e&&(h+=" "+f);h+='" ';h=(c?h+'style="position:absolute;top:-9999px;':h+('data-index="'+b+'"'))+">";1==a.options.showCheckBoxes&&(h+='<iui-checkbox name="cb-'+d.getUniqueId(4)+'"',e=a.options.checkBoxSettings?1==a.options.checkBoxSettings.threeState:!1,f=a.currentList[b],e&&void 0==f[a.options.dataFields.checkState]?f[a.options.dataFields.checkState]="unchecked":void 0==f[a.options.dataFields.checked]&&(f[a.options.dataFields.checked]=!1),e?(h+=' check-state="data['+b+"]."+a.options.dataFields.checkState+'"',h+=' checkstate-changing="onCheckValueChanging(e, '+b+')"',h+=' checkstate-changed="onCheckValueChanged(e, '+b+')"',h+=' three-state="true"'):(h+=' checked="data['+b+"]."+a.options.dataFields.checked+'"',h+=' checked-changing="onCheckValueChanging(e, '+b+')"',h+=' checked-changed="onCheckValueChanged(e, '+b+')"'),a.options.checkBoxSettings&&a.options.checkBoxSettings.style&&t.checkBoxStyle?h+=' control-style="checkBoxStyle"':a.options.controlStyle.item.checkBox&&t.checkBoxStyle&&(h+=' control-style="checkBoxStyle"'),a.isItemEnabled(a.currentList[b])||(h+=' enabled="false"'),h+=' style="display:inline-block;margin:0 2px;padding-bottom:2px;vertical-align:middle;',0<P&&(h+="width: "+P+"px;"),h+='"></iui-checkbox>');0!=a.options.showIcons&&(a.currentList[b].icon||a.options.itemIcon)&&(e=a.currentList[b],f="",e[a.options.dataFields.icon]?f=e[a.options.dataFields.icon]:a.options.itemIcon&&(f=a.options.itemIcon),h+='<span class="'+f+'" data-element="icon"></span>');e=a.defaultStyle.item.content.normal;a.options.controlStyle.item.content.normal!=e&&(e+=" "+a.options.controlStyle.item.content.normal);f=a.getCurrentItemContentStyle(a.currentList[b],"normal");a.currentList[b].content?(h+='<div class="'+e+" "+f+'" data-element="content">',h+=a.currentList[b][a.options.dataFields.content],h+="</div>"):(h+='<span class="'+e+" "+f+'" data-element="content"',!c&&a.currentList[b].contextMenu&&(h+=' iui-contextmenu menu-items="data['+b+'].contextMenu"'),h+=">",h=c?h+a.currentList[b][a.options.dataFields.text]:h+("{{data["+b+"]."+a.options.dataFields.text+"}}"),h+="</span>");return h+="</li>"},P=0,Y=function(){if(1==a.options.showCheckBoxes){var c=angular.element(b('<iui-checkbox style="position:absolute;top:-9999px"></iui-checkbox>')(l));g.append(c);P=0;c&&0<c.children().length&&(P=parseInt(getComputedStyle(angular.element(c.children().eq(0))[0]).width,10));c.remove()}};a.updateView=function(c){var f=k(function(){F||T();n();r.empty();t&&t.$destroy();U(!1);a.currentList.length>=u&&e+u-1>a.currentList.length&&(e=a.currentList.length-u+1);if(e<a.currentList.length){t=l.$new();t.data=a.currentList;t.checkBoxStyle=a.options.checkBoxSettings.style;!t.checkBoxStyle&&a.options.controlStyle.item.checkBox&&(t.checkBoxStyle=a.options.controlStyle.item.checkBox);z=0;var c="";firstItemElem=c=null;for(var q=d.getMargin(),m=0,p=e;p<e+u&&p<a.currentList.length;p++)c=W(p),c=a.currentList[p].content?b(c)(l.$parent):b(c)(t),c=angular.element(c),r.append(c),q=d.getMargin(c[0]),m+=c[0].offsetHeight+(q.top+q.bottom),z++;if(0<z){p=null;c=r.find("li");if(0<c.length)for(var q=null,v=0;v<c.length;v++)q=angular.element(c[v]),(p=a.getItemFromElem(q))&&a.isItemEnabled(p)&&K(q);p=g[0].offsetHeight-6;w=m/z;u=Math.floor(p/w)+1;T()}a.refresh()}k.cancel(f)},1)};a.refresh=function(b){if(b){var c=null;switch(b.type){case "item":if(c=a.getElemFromItem(b)){c.removeAttr("class");c.addClass(a.defaultStyle.item.general.normal);c.addClass(a.options.controlStyle.item.general.normal);var d=a.getCurrentItemStyle(b,a.getObjState(b));d!=a.options.controlStyle.item.general.normal&&c.addClass(d);if(c=a.getElement(c))c.removeAttr("class"),c.addClass(a.defaultStyle.item.content.normal),c.addClass(a.options.controlStyle.item.content.normal),d=a.getCurrentItemContentStyle(b,a.getObjState(b)),d!=a.options.controlStyle.item.content.normal&&c.addClass(d)}}}else for(b=e;b<e+u&&b<a.currentList.length;b++)a.refresh(a.currentList[b])};var Q=!1,J=0,R=null,S=.5;a.isScrollBarVisible=function(){return A};a.scrollPos={x:0,y:0};a.getScrollPos=function(){return a.scrollPos};a.setScrollPos=function(b){b&&(b.x=0,0>b.y&&(b.y=0),b.y>H.y&&(b.y=H.y),a.scrollPos=b,N=Math.floor(a.scrollPos.y/(w*L)),b=D+N,A&&v&&v.css("top",b+"px"),U(),angular.isDefined(l.events)&&l.events.scrollPosChanged?l.events.scrollPosChanged({scrollPos:a.scrollPos}):l.scrollposChanged({e:{scrollPos:a.scrollPos}}))};var X=function(b,c,d){Q||(J=0,Q=!0,R=B(function(){var d=c,e=a.getScrollPos();d||(0===J&&(J=5),J+=5+L,S+=.5,d=J+=Math.floor(S));e.y=b?e.y+d:e.y-d;a.setScrollPos(e);(0>=e.y||a.getScrollPos().y<e.y)&&V()},d?d:100))},V=function(){Q&&(R&&(B.cancel(R),R=null),Q=!1,J=0,S=.5)};a.cancelScrollTimer=function(){V()};a.scrollTo=function(b,c){if(b){var d=a.getItemCurrentIndex(b);if(a.isIndexInRange(d)){var e=0,f=d;switch(c){case "center":e=Math.floor(z/2);f=d>e?d-e:0;break;case "bottom":e=z-2,f=d>e?d-e:0}var g=k(function(){a.setScrollPos({x:a.scrollPos.x,y:f*w});k.cancel(g)},1)}}};var U=function(b,c){if(!(0==b&&0>=w)){newIndex=0<w?Math.floor(a.scrollPos.y/w):0;if(c||newIndex+u-1>a.currentList.length)newIndex=a.currentList.length-u+1;0>newIndex&&(newIndex=0);newIndex!==e&&(e=newIndex,0!=b&&a.updateView(!0))}};g.bind("scroll",function(a){g[0].scrollTop=0;g[0].scrollLeft=0});g.bind("mousewheel",function(b){b.preventDefault();a.hoverItem=null;var c=0;b.wheelDelta?c=Math.max(-1,Math.min(1,b.wheelDelta||-b.detail)):b.originalEvent&&(c=Math.max(-1,Math.min(1,b.originalEvent.wheelDelta||-b.originalEvent.detail)));a.setScrollPos({x:a.scrollPos.x,y:a.scrollPos.y+Math.floor(g[0].clientHeight/4)*c*-1});k(function(){var c=d.getMousePos(b),e=angular.element(f)[0].pageXOffset,g=angular.element(f)[0].pageYOffset;c.x-=e;c.y-=g;if(c=a.getItemAt(c.x,c.y))a.hoverItem=c,a.refresh()},1)});angular.element(f).bind("mousemove",function(b){if(F&&1===b.which){v[0].getBoundingClientRect();b=d.getMousePos(b);C.scrollMousePos||(C.scrollMousePos=b);var c=v[0].offsetTop+(b.y-C.scrollMousePos.y);c<D?c=D:c+v[0].offsetHeight>x&&(c=x-v[0].offsetHeight);v.css("top",c+"px");C.scrollMousePos=b;N=c-D;a.scrollPos.y=c+v[0].offsetHeight>=x?H.y:Math.floor(N*L*w);U(!0,a.scrollPos.y==H.y)}});angular.element(f).bind("mouseup",function(b){F&&a.updateView();V();C.scrollMousePos=null;F=!1});angular.isDefined(l.options)?a.updateOptions(l.options):(0==l.allowFocus&&(a.options.allowFocus=l.allowFocus),angular.isDefined(l.checkboxSettings)&&a.updateCheckBoxSettings(l.checkboxSettings),angular.isDefined(l.controlStyle)&&a.updateControlStyle(l.controlStyle),angular.isDefined(l.fields)&&(a.updateDataFields(l.fields),a.updateData()),angular.isDefined(l.itemIcon)&&(a.options.itemIcon=l.itemIcon),angular.isDefined(l.navSelection)&&(a.options.navSelection=l.navSelection),!0===l.rtl&&(a.options.rtl=l.rtl),angular.isDefined(l.selectedIndex)&&(a.options.selectedIndex=l.selectedIndex),angular.isDefined(l.selectedItem)&&(a.options.selectedItem=l.selectedItem),!0===l.showCheckBoxes&&(a.options.showCheckBoxes=l.showCheckBoxes),!1===l.showIcons&&(a.options.showIcons=l.showIcons));a.updateLayout()}}}]);